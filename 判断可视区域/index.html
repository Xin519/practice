<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
	</head>
	<style type="text/css">
		.container {
		    display: flex;
		    flex-wrap: wrap;
		}
		.target {
		    margin: 5px;
		    width: 20px;
		    height: 20px;
		    background: #ccc;
		}
	</style>
	<body>
		<div class="">
			<div class="container"></div>
		</div>
		
		<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			const $container = $(".container");
			
			// 插入 100000 个 <div class="target"></div>
			function createTargets() {
			  const htmlString = new Array(100000)
			    .fill('<div class="target"></div>')
			    .join("");
			  $container.html(htmlString);
			}
			createTargets()
			
			const $targets = $(".target");
			
			function isInViewPort(element) {
			    const viewWidth = window.innerWidth || document.documentElement.clientWidth;
			    const viewHeight =
			          window.innerHeight || document.documentElement.clientHeight;
			    const { top, right, bottom, left } = element.getBoundingClientRect();
			
			    return top >= 0 && left >= 0 && right <= viewWidth && bottom <= viewHeight;
			}
			
			
			$(window).on("scroll", () => {
			    console.log("scroll !");
			    $targets.each((index, element) => {
			        if (isInViewPort(element)) {
			            $(element).css("background-color", "yellow");
			        }
			    });
			});
			
			
			// const observer = new IntersectionObserver(getYellow, { threshold: 1.0 });
			
			// function getYellow(entries, observer) {
			//     entries.forEach(entry => {
			//         $(entry.target).css("background-color", "yellow");
			//     });
			// }
			
			// $targets.each((index, element) => {
			//     observer.observe(element);
			// });
			
		</script>
	</body>
</html>
